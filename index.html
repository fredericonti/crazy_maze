<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="css/crazymaze.css">
    <title>Document</title>
</head>

<body>
    <div class="background">
        <div id="container"></div>
        <div id="ofim"></div>
    </div>

    <script>


        //elements
        var guy = document.querySelector("guy");
        var empty = document.querySelector('.empty');
        var container = document.querySelector('#container');
        var ofim = document.querySelector('#ofim');
        
        var winner = '';

        //object guy
        var positionGuy = {
            x: 0,
            y: 0
        }

        //matriz
        var linha1 = ["guy", "pipe", "empty", "empty", "empty", "pipe", "pipe", "pipe", "pipe", "pipe", "empty", "empty", "empty", "pipe", "pipe"];
        var linha2 = ["empty", "end", "empty", "pipe", "empty", "pipe", "pipe", "pipe", "pipe", "pipe", "pipe", "pipe", "pipe", "pipe", "pipe"]
        var linha3 = ["pipe", "pipe", "pipe", "pipe", "empty", "pipe", "empty", "pipe", "pipe", "pipe", "pipe", "pipe", "pipe", "pipe", "pipe"]
        var linha4 = ["candy", "empty", "empty", "pipe", "empty", "empty", "empty", "pipe", "pipe", "pipe", "pipe", "pipe", "pipe", "pipe", "pipe"]
        var linha5 = ["pipe", "pipe", "empty", "pipe", "empty", "pipe", "pipe", "pipe", "empty", "pipe", "pipe", "pipe", "pipe", "pipe", "pipe"];
        var linha6 = ["pipe", "pipe", "empty", "empty", "empty", "empty", "empty", "empty", "pipe", "pipe", "pipe", "pipe", "pipe", "pipe", "pipe"];
        var linha7 = ["pipe", "pipe", "empty", "pipe", "pipe", "empty", "pipe", "pipe", "pipe", "pipe", "pipe", "pipe", "pipe", "pipe", "pipe"];
        var linha8 = ["pipe", "empty", "empty", "pipe", "empty", "empty", "pipe", "pipe", "pipe", "pipe", "pipe", "pipe", "pipe", "pipe", "pipe"];
        var linha9 = ["pipe", "pipe", "empty", "empty", "empty", "pipe", "pipe", "pipe", "pipe", "pipe", "pipe", "pipe", "pipe", "pipe", "pipe"];
        var linha10 = ["pipe", "pipe", "pipe", "pipe", "empty", "pipe", "pipe", "pipe", "pipe", "pipe", "pipe", "pipe", "pipe", "pipe", "pipe"];
        var linha11 = ["pipe", "pipe", "pipe", "empty", "empty","pipe", "pipe", "pipe", "pipe", "empty", "empty", "empty", "pipe", "pipe", "pipe"];
        var linha12 = ["pipe", "pipe", "pipe", "empty", "pipe", "pipe", "pipe", "pipe", "pipe", "empty", "pipe", "empty", "pipe", "pipe", "pipe"];
        var linha13 = ["pipe", "pipe", "pipe", "empty", "pipe", "pipe", "pipe", "empty", "empty", "empty", "pipe", "empty", "pipe", "pipe", "pipe"];
        var linha14 = ["pipe", "pipe", "pipe", "empty", "pipe","pipe", "empty", "empty", "pipe", "pipe", "pipe", "empty", "pipe", "pipe", "pipe"];
        var linha15 = ["pipe", "pipe", "pipe", "empty", "empty","empty", "empty", "pipe", "pipe", "pipe", "empty", "empty", "empty", "empty", "end"];


        //array de arrays
        var matriz = [
            linha1,
            linha2,
            linha3,
            linha4,
            linha5,
            linha6,
            linha7,
            linha8,
            linha9,
            linha10,
            linha11,
            linha12,
            linha13,
            linha14,
            linha15,
        ];

        function updateMatriz(matriz) {
            //ele apaga o html do container com essa string vazia
            container.innerHTML = '';
            matriz.forEach(function (elementoAtual) {
                escreveLinha(elementoAtual);
            });
            
        }
        //função final!
        function endGame() {
            container.innerHTML = '';
            ofim.innerHTML = "acabou";
        };

        //Primeira função:escreve uma div por coluna
        function escreveLinha(itens) {
            //map cria uma nova array
            var linha = itens.map(function (item) {
                var div = criaUmaDiv(item);
                return div;
            });

            var containerLinha = escreveContainerLinha(linha);
            // console.log(containerLinha);
            //append chama a função
            container.append(containerLinha);

        };

        function criaUmaDiv(classname) {
            //sintaxe para criar uma div
            var linhaDiv = document.createElement('div');
            //class name vem do argumento da função
            linhaDiv.className = classname;
            return linhaDiv;
        }

        function escreveContainerLinha(items) {
            var linhaDiv = criaUmaDiv("linha");

            items.forEach(function (elemento) {
                linhaDiv.append(elemento);
            })
            return linhaDiv;
        };

        //movimento
        document.addEventListener('keydown', function (event) {
            if (event.keyCode === 38) {
                andar("cima")
            }

            if (event.keyCode === 39) {
                andar("direita");
            }

            if (event.keyCode === 40) {
                andar("baixo")
            }

            if (event.keyCode === 37) {
                andar("esquerda")
            }

        });

        function andar(direcao) {
            // if (!direcao) {
            //     return false;
            // }

            if (direcao == "direita") {
                troca("direita");
            } else if (direcao == "esquerda") {
                troca('esquerda');
            } else if (direcao == "cima") {
                troca("cima");
            } else if (direcao == "baixo") {
                troca("baixo");
            }

        };

        function troca(destino) {
            var x = positionGuy.x;
            var y = positionGuy.y;


            if (destino === 'direita') {
                // verifica se a posicao da direita esta vazia
                var posicaoDestino = matriz[x][y + 1];
                if (posicaoDestino === 'empty') {
                    var posicaoAux = matriz[x][y];
                    matriz[x][y] = matriz[x][y + 1];
                    matriz[x][y + 1] = posicaoAux;
                    positionGuy.y = y + 1;

                }

                if(posicaoDestino === 'end'){
                    matriz[x][y] = "empty";
                    matriz[x][y + 1] = "win";
                }

            } else if (destino === 'esquerda') {
                // verifica se a posicao da esquerda esta vazia
                var yDestino = 0;
                if (y > 0) {
                    yDestino = y - 1;
                }
                var posicaoDestino = matriz[x][yDestino];

                if (posicaoDestino === 'empty') {
                    var posicaoAux = matriz[x][y];
                    matriz[x][y] = matriz[x][yDestino];
                    matriz[x][yDestino] = posicaoAux;
                    positionGuy.y = yDestino;

                }

                if(posicaoDestino === 'end'){
                    matriz[x][yDestino] = "empty";
                    matriz[x][yDestino - 1] = "win";
                    console.log("chegou")
                }


            } else if (destino === 'cima') {
                var xDestino = 0;
                if (x > 0) {
                    xDestino = x - 1;
                }

                // verifica se a posicao da cima esta vazia
                var posicaoDestino = matriz[xDestino][y];
                if (posicaoDestino === 'empty') {
                    var posicaoAux = matriz[x][y];
                    matriz[x][y] = matriz[xDestino][y];
                    matriz[xDestino][y] = posicaoAux;
                    positionGuy.x = xDestino;

                }

            } else if (destino === 'baixo') {
                var posicaoDestino = matriz[x + 1][y];
                if (posicaoDestino === 'empty') {
                    var posicaoAux = matriz[x][y];
                    matriz[x][y] = matriz[x + 1][y];
                    matriz[x + 1][y] = posicaoAux;
                    positionGuy.x = x + 1;
                }

            } else {
                return false;
            }
            if(posicaoDestino === "end"){
                endGame()
            } else {
                updateMatriz(matriz);
            }
        };

        // inicia jogo
        updateMatriz(matriz)
    </script>
</body>

</html>